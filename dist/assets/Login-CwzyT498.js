import{u as P,c as T,d as C,r as i,b as c,B as n,j as s,L as E}from"./index-DhLjg7ZU.js";const U=()=>{const{dispatch:r,store:{MyDetails:l}}=P(),f=T(),w=C(),b=new URLSearchParams(w.search);let y;for(let[e,t]of b.entries())e==="url"&&(y=t);const[x,j]=i.useState(y);console.log({setUrl:j});const[o,d]=i.useState({method:"password",identifyId:"",otp:"",password:""}),v=async()=>{try{r("loading",!0),r("nav",!1);const{data:e}=await c.get("/api/v1/myaccount",{withCredentials:!0});if(console.log({data:e}),e.success){const t=e.user;r("MyDetails",{...l,...t})}e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("Error getting user data",e),n.error(e.message,{position:"bottom-center"})}r("loading",!1)},p=async()=>{try{await v(),console.log("onSuccess"),r("role","user"),f(x||"/dashboard")}catch(e){console.log(e)}};i.useEffect(()=>{o.method==="otp"&&I()},[o.method]);const u=e=>{const{name:t,value:g}=e.target;d({...o,[t]:g})};function m(e){const t=Math.floor(e/1e3),g=String(Math.floor(t/60)).padStart(2,"0"),N=String(t%60).padStart(2,"0");return`Please wait: ${g}:${N} seconds`}const[S,h]=i.useState("");let a;const I=async()=>{try{r("loading",!0);const{data:e}=await c.post("/api/v1/send-otp",{identifyId:o.identifyId});if(console.log({data:e}),e.success&&(n.success("OTP sent successfully!",{position:"bottom-center"}),d(t=>({...t,otp:e.otp}))),e.error&&n.error(e.error,{position:"bottom-center"}),e.wait){let t=e.wait;h(m(t)),a&&clearInterval(a),a=setInterval(()=>{t-=1e3,t<0?(clearInterval(a),h("")):h(m(t))},1e3),n.warning(m(t),{position:"bottom-center"})}}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}r("loading",!1)},L=async()=>{try{if(r("loading",!0),o.method==="password")return D();const{data:e}=await c.post("/api/v1/verify-otp",{otp:String(o.otp)});console.log({data:e}),e.success&&(n.success("Login successfully!",{position:"bottom-center"}),p()),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}r("loading",!1)},D=async()=>{try{r("loading",!0);const{data:e}=await c.post("/api/v1/login",o);console.log({data:e}),e.success&&(n.success("Login successfully!",{position:"bottom-center"}),p()),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}r("loading",!1)};return i.useEffect(()=>{l&&p()},[l]),s.jsx("div",{className:"login-form",children:s.jsxs("form",{onSubmit:e=>e.preventDefault(),children:[s.jsx("h1",{children:"Login Form"}),s.jsxs("div",{className:"bg-white",children:[s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"identifyId",children:"Contact/ID/Email/Username : "}),s.jsx("input",{type:"",onChange:u,name:"identifyId",id:"identifyId",value:o.identifyId,placeholder:"IdentifyId"}),s.jsx("p",{children:S})]}),s.jsxs("div",{className:"swipe-side",children:[s.jsx("span",{children:"OTP"}),s.jsxs("div",{className:"swipe-btn",children:[s.jsx("input",{type:"checkbox",onChange:()=>d({...o,method:o.method==="password"?"otp":"password"}),id:"swipe-btn",checked:o.method==="password"}),s.jsx("label",{htmlFor:"swipe-btn"})]}),s.jsx("span",{children:"Password"})]}),s.jsx("div",{style:{display:o.method==="password"?"":"none"},children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"password",children:"Password : "}),s.jsx("input",{onChange:u,type:"password",name:"password",id:"password",value:o.password,placeholder:"password"})]})}),s.jsx("div",{style:{display:o.method==="otp"?"":"none"},children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"otp",children:"One Time Password : "}),s.jsx("input",{type:"number",onChange:u,name:"otp",id:"otp",value:o.otp,placeholder:"Enter OTP"})]})})]}),s.jsxs("div",{className:"btns",children:[s.jsx("button",{type:"submit",onClick:L,children:"Verify & Login"}),s.jsx("br",{}),"If you not registered ",s.jsx(E,{to:"/signup",children:"Sign-Up"})]})]})})};export{U as default};
