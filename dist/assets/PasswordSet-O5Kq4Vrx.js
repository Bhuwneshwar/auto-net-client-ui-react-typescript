import{u as T,r as u,j as s,b as d,B as n}from"./index-DhLjg7ZU.js";function i(t){const p=Math.floor(t/1e3),a=String(Math.floor(p/60)).padStart(2,"0"),m=String(p%60).padStart(2,"0");return`Please wait: ${a}:${m} seconds`}const M=()=>{const{dispatch:t,store:{MyDetails:p}}=T(),[a,m]=u.useState({oldPassword:"",newPassword:"",confirmPassword:"",method:"password",otp:""}),f=e=>{m({...a,[e.target.name]:e.target.value})},[r,P]=u.useState({oldBalancePin:"",newBalancePin:"",confirmBalancePin:"",method:"BalancePin",otp:""}),g=e=>{P(o=>({...o,[e.target.name]:e.target.value}))},[x,w]=u.useState("");let c;const b=async()=>{try{t("loading",!0);const{data:e}=await d.get("/api/v1/send-otp",{withCredentials:!0});if(console.log({data:e}),e.success&&(n.success(e.message,{position:"bottom-center"}),m(o=>({...o,otp:e.otp}))),e.wait){let o=e.wait;w(i(o)),c&&clearInterval(c),c=setInterval(()=>{o-=1e3,o<0?(clearInterval(c),w("")):w(i(o))},1e3),n.warning(i(o),{position:"bottom-center"})}e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)};u.useEffect(()=>{a.method==="otp"&&b()},[a.method]);const B=async()=>{try{t("loading",!0);const{data:e}=await d.post("/api/v1/account/verify-otp",{otp:a.otp,verifyReason:"set-password"});if(console.log({data:e}),e.success&&n.success("OTP verified successfully!",{position:"bottom-center"}),e.wait){let o=e.wait;w(i(o)),c&&clearInterval(c),c=setInterval(()=>{o-=1e3,o<0?(clearInterval(c),w("")):w(i(o))},1e3),n.warning(i(o),{position:"bottom-center"})}e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)},v=async()=>{try{if(a.newPassword!==a.confirmPassword)return n.error("New password and confirm password do not match",{position:"bottom-center"});t("loading",!0);const{data:e}=await d.post("/api/v1/change-password",{oldPassword:a.oldPassword,newPassword:a.newPassword,confirmPassword:a.confirmPassword},{withCredentials:!0});console.log({data:e}),e.success&&(n.success("Password change successfully",{position:"bottom-center"}),m(o=>({...o,newPassword:"",oldPassword:"",confirmPassword:""}))),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log(e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)},j=async()=>{try{t("loading",!0);const{data:e}=await d.post("/api/v1/set-password",{newPassword:a.newPassword,confirmPassword:a.confirmPassword,verifyReason:"set-password"},{withCredentials:!0});console.log({data:e}),e.success&&(n.success("Password set successfully",{position:"bottom-center"}),p&&t("MyDetails",{...p,password:e.password}),m(o=>({...o,newPassword:"",oldPassword:"",confirmPassword:""}))),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log(e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)},[y,h]=u.useState("");let l;const N=async()=>{try{t("loading",!0);const{data:e}=await d.get("/api/v1/send-otp",{withCredentials:!0});if(console.log({data:e}),e.success&&(n.success(e.message,{position:"bottom-center"}),P(o=>({...o,otp:e.otp}))),e.wait){let o=e.wait;h(i(o)),l&&clearInterval(l),l=setInterval(()=>{o-=1e3,o<0?(clearInterval(l),h("")):h(i(o))},1e3),n.warning(i(o),{position:"bottom-center"})}e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)};u.useEffect(()=>{r.method==="otp"&&N()},[r.method]);const I=async()=>{try{t("loading",!0);const{data:e}=await d.post("/api/v1/account/verify-otp",{otp:r.otp,verifyReason:"set-balance-pin"});if(console.log({data:e}),e.success&&n.success("OTP verified successfully!",{position:"bottom-center"}),e.wait){let o=e.wait;h(i(o)),l&&clearInterval(l),l=setInterval(()=>{o-=1e3,o<0?(clearInterval(l),h("")):h(i(o))},1e3),n.warning(i(o),{position:"bottom-center"})}e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log("login : "+e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)},C=async()=>{try{t("loading",!0);const{data:e}=await d.post("/api/v1/change-balance-pin",{oldBalancePin:r.oldBalancePin,newBalancePin:r.newBalancePin,confirmBalancePin:r.confirmBalancePin},{withCredentials:!0});console.log({data:e}),e.success&&(n.success("Balance PIN change successfully",{position:"bottom-center"}),P(o=>({...o,newBalancePin:"",oldBalancePin:"",confirmBalancePin:""}))),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log(e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)},S=async()=>{try{t("loading",!0);const{data:e}=await d.post("/api/v1/set-balance-pin",{newBalancePin:r.newBalancePin,confirmBalancePin:r.confirmBalancePin,verifyReason:"set-balance-pin"},{withCredentials:!0});console.log({data:e}),e.success&&(n.success("Balance PIN set successfully",{position:"bottom-center"}),p&&t("MyDetails",{...p,balancePin:e.BalancePin}),P(o=>({...o,oldBalancePin:"",newBalancePin:"",confirmBalancePin:"",otp:""}))),e.error&&n.error(e.error,{position:"bottom-center"})}catch(e){console.log(e),n.error(e.message,{position:"bottom-center"})}t("loading",!1)};return s.jsx("div",{className:"main set-password",children:s.jsxs("div",{className:"login-form",children:[s.jsxs("form",{onSubmit:e=>e.preventDefault(),children:[s.jsx("h2",{children:" SET PASSWORD"}),s.jsxs("div",{className:"bg-white",children:[s.jsxs("div",{className:"swipe-side",children:[s.jsx("span",{children:"USING OTP"}),s.jsxs("div",{className:"swipe-btn",children:[s.jsx("input",{type:"checkbox",onChange:()=>m({...a,method:a.method==="password"?"otp":"password"}),id:"swipe-btn",checked:a.method==="password"}),s.jsx("label",{htmlFor:"swipe-btn"})]}),s.jsx("span",{children:"USING PASSWORD"})]}),s.jsx("div",{className:a.method==="otp"?"otpMode":"otpModeHide",children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"otp",children:"One Time Password : "}),s.jsx("input",{type:"number",onChange:f,name:"otp",id:"otp",onBlur:B,value:a.otp,placeholder:"Enter OTP"}),s.jsx("p",{className:"otp-timer",children:x})]})}),s.jsx("div",{className:a.method==="password"?"otpMode":"otpModeHide",children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"password",children:"Old password : "}),s.jsx("input",{onChange:f,type:"password",name:"oldPassword",id:"password",value:a.oldPassword,placeholder:"password"})]})}),s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"newPassword",children:"New Password : "}),s.jsx("input",{value:a.newPassword,name:"newPassword",onChange:f,type:"password",id:"newPassword",placeholder:"New Password"})]}),s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password : "}),s.jsx("input",{value:a.confirmPassword,name:"confirmPassword",onChange:f,id:"confirmPassword",type:"password",placeholder:"Confirm Password"})]})]}),s.jsx("br",{}),s.jsx("div",{className:"btns",children:s.jsx("button",{type:"submit",onClick:()=>a.method==="otp"?j():v(),children:"Set Password"})})]}),s.jsx("hr",{}),s.jsx("br",{}),s.jsx("br",{}),s.jsxs("form",{onSubmit:e=>e.preventDefault(),children:[s.jsx("h2",{children:" SET BALANCE PIN"}),s.jsxs("div",{className:"bg-white",children:[s.jsxs("div",{className:"swipe-side",children:[s.jsx("span",{children:"USING OTP"}),s.jsxs("div",{className:"swipe-btn",children:[s.jsx("input",{type:"checkbox",onChange:()=>P({...r,method:r.method==="BalancePin"?"otp":"BalancePin"}),id:"swipe-btnBalancePin",checked:r.method==="BalancePin"}),s.jsx("label",{htmlFor:"swipe-btnBalancePin"})]}),s.jsx("span",{children:"USING BALANCE PIN"})]}),s.jsx("div",{className:r.method==="otp"?"otpMode":"otpModeHide",children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"otpB",children:"One Time Password : "}),s.jsx("input",{type:"number",onChange:g,name:"otp",id:"otpB",onBlur:I,value:r.otp,placeholder:"Enter OTP"}),s.jsx("p",{children:y})]})}),s.jsx("div",{className:r.method==="BalancePin"?"otpMode":"otpModeHide",children:s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"passwordB",children:"Old Balance Pin : "}),s.jsx("input",{onChange:g,type:"password",name:"oldBalancePin",id:"passwordB",value:r.oldBalancePin,placeholder:"Balance Pin"})]})}),s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"newBalancePin",children:"New Balance Pin : "}),s.jsx("input",{value:r.newBalancePin,name:"newBalancePin",onChange:g,type:"password",id:"newBalancePin",placeholder:"New Balance PIN"})]}),s.jsxs("div",{className:"input-text",children:[s.jsx("label",{htmlFor:"confirmBalancePin",children:"Confirm Balance Pin : "}),s.jsx("input",{value:r.confirmBalancePin,name:"confirmBalancePin",onChange:g,type:"password",id:"confirmBalancePin",placeholder:"Confirm Balance PIN"})]})]}),s.jsx("br",{}),s.jsx("div",{className:"btns",children:s.jsx("button",{type:"submit",onClick:()=>r.method==="otp"?S():C(),children:"Set Balance PIN"})})]})]})})};export{M as default};
